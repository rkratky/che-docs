<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content="installationkubernetes,  kubernetes, configuration, admin guide">
<title>Che on Kubernetes: Admin Guide | Eclipse Che Documentation</title>
<link rel="stylesheet" href="/che-docs/css/syntax.css">
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="/che-docs/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="/che-docs/css/customstyles.css">
<link rel="stylesheet" href="/che-docs/css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="/che-docs/css/theme-che.css">


    <link rel="stylesheet" href="/che-docs/css/coderay.css" media="screen" type="text/css">
    <link rel="stylesheet" href="/che-docs/css/asciidoc.css" type="text/css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" crossorigin="anonymous"></script>
<script src="/che-docs/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js" crossorigin="anonymous"></script>
<script src="/che-docs/js/toc.js"></script>
<script src="/che-docs/js/customscripts.js"></script>

<link rel="shortcut icon" href="/che-docs/images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="che" href="/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: false,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="/che-docs/">&nbsp;<span class="projectTitle"> Eclipse Che Documentation</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://medium.com/eclipse-che-blog/" target="_blank">Blog</a></li>
                
                
                
                <li><a href="https://github.com/eclipse/che" target="_blank">Source Code</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Che Version<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li class="dropdownActive"><a href="/che-docs/che-6">Che 6</a></li>
                        
                        
                        
                        <li><a href="/che-docs/che-7">Che 7</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Get Support<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/eclipse/che/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc+label%3Akind%2Fbug" target="_blank">Known Bugs</a></li>
                        
                        
                        
                        <li><a href="https://github.com/eclipse/che/issues/new" target="_blank">File an Issue</a></li>
                        
                        
                        
                        <li><a href="https://stackoverflow.com/questions/tagged/eclipse-che" target="_blank">Che on StackOverflow</a></li>
                        
                        
                    </ul>
                </li>
                
                
                <!-- 
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:?subject= feedback&body=I have some feedback about the Che on Kubernetes: Admin Guide page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>
 -->
		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="/che-docs/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: "/che-docs/search.json",
                                searchResultTemplate: '<li><a href="{url}" title="Che on Kubernetes: Admin Guide">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">Eclipse Che 6</li>
  
  <div class="sidebarSubtitle">Documentation Topics</div>
  
  
      
  
  <li>
      
      <a href="#" class="expandable">Overview</a>
      
      <ul>
          
          
          
          <li><a href="/che-docs/che-6/index.html">Introduction</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/quick-start.html">Getting Started</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/single-multi-user.html">Single and Multi-User Flavors</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/infra-support.html">Supported Infrastructures</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="#" class="expandable">Che on Docker</a>
      
      <ul>
          
          
          
          <li><a href="/che-docs/che-6/docker-single-user.html">Docker - Single User</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/docker-multi-user.html">Docker - Multi User</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/docker-config.html">Docker - Configuration</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/docker-cli.html">Docker - CLI Reference</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="#" class="expandable">Che on Kubernetes</a>
      
      <ul>
          
          
          
          <li><a href="/che-docs/che-6/kubernetes-single-user.html">Kubernetes - Single User</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/kubernetes-multi-user.html">Kubernetes - Multi User</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/kubernetes-config.html">Kubernetes - Configuration</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/kubernetes-admin-guide.html">Kubernetes - Admin Guide</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="#" class="expandable">Che on OpenShift</a>
      
      <ul>
          
          
          
          <li><a href="/che-docs/che-6/openshift-single-user.html">OpenShift - Single User</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/openshift-multi-user.html">OpenShift - Multi User</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/openshift-config.html">OpenShift - Configuration</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/openshift-admin-guide.html">OpenShift - Admin Guide</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="#" class="expandable">User Management</a>
      
      <ul>
          
          
          
          <li><a href="/che-docs/che-6/user-management.html">Authentication and Authorization</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/authentication.html">Security Model</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/permissions.html">Permissions</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/organizations.html">Organizations in UD</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/resource-management.html">Resource Management</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="#" class="expandable">User Guides</a>
      
      <ul>
          
          
          
          <li><a href="/che-docs/che-6/creating-starting-workspaces.html">Creating and starting Workspaces</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/ide-projects.html">Projects</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/editor-code-assistance.html">Editor and Code-Assistance</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/dependency-management.html">Dependency Management</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/commands-ide-macro.html">Commands and IDE Macros</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/version-control.html">Version Control</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/debug.html">Debug</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="#" class="expandable">Workspace Administration</a>
      
      <ul>
          
          
          
          <li><a href="/che-docs/che-6/what-are-workspaces.html">Workspace Overview</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/stacks.html">Workspace - Stacks</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/recipes.html">Workspace - Recipes</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/servers.html">Workspace - Servers</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/installers.html">Workspace - Installers</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/volumes.html">Workspace - Volumes Mount</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/env-variables.html">Workspace - Environment Variables</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/projects.html">Workspace - Projects</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/workspaces-troubleshooting.html">Workspace - Troubleshooting</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/workspace-data-model.html">Workspace Data Model</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="#" class="expandable">Portable Workspaces</a>
      
      <ul>
          
          
          
          <li><a href="/che-docs/che-6/chedir-getting-started.html">Chedir - Getting Started</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/why-chedir.html">Chedir - Why Chedir?</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/chedir-installation.html">Chedir - Installation</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/chedir-project-setup.html">Chedir - Project Setup</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/chedir-up-and-down.html">Chedir - Up and Down</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/chefile.html">Chedir - Chefile</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/chedir-ssh.html">Chedir - SSH</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/factories-getting-started.html">Factory - Getting Started</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/creating-factories.html">Factory - Creating</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/factories_json_reference.html">Factory - JSON Reference</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="#" class="expandable">Developer Guides</a>
      
      <ul>
          
          
          
          <li><a href="/che-docs/che-6/framework-overview.html">Overview</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/rest-api.html">SDK - REST API</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/che-in-che-quickstart.html">SDK - Your First Plugin</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/build-reqs.html">SDK - Building Che</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/assemblies.html">SDK - Assemblies</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/logging.html">SDK - Logging</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/ide-extensions-gwt.html">SDK - GWT IDE Extensions</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/server-side-extensions.html">SDK - Server Side Extensions</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/custom-installers.html">SDK - Installers</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/project-types.html">SDK - Project Types</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/language-servers.html">SDK - Language Support</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/parts.html">IDE UI&#58 Parts</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/actions.html">IDE UI&#58 Actions</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="#" class="expandable">Dev Essentials</a>
      
      <ul>
          
          
          
          <li><a href="/che-docs/che-6/guice.html">Dependency Injection</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/dto.html">Transport&#58 DTO</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/json-rpc.html">Communication&#58 JSON-RPC</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/handling-projects-in-plugins.html">Handling Projects in Plugins</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/dao.html">Persistence, DAO</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/properties.html">Properties</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="#" class="expandable">Infrastructure and SPI</a>
      
      <ul>
          
          
          
          <li><a href="/che-docs/che-6/spi_overview.html">Overview</a></li>
          
          
          
          
          
          
          <li><a href="/che-docs/che-6/spi-implementation.html">Implementation Notes</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block: -->
         <p class="external">
             <a href="#" id="collapseAll">Collapse all</a> | <a href="#" id="expandAll">Expand all</a>
         </p>
         
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>

            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Che on Kubernetes: Admin Guide</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.
$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2' });
/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top
  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    


    <!-- 


     -->

  <div class="paragraph">
<p>hen the deployment YAML files run,</p>
</div>
<div class="sect1">
<h2 id="ram-prerequisites">RAM prerequisites</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="single-user-prerequisites">Single-user prerequisites</h3>
<div class="paragraph">
<p>3 GB of RAM is required for single-user Che on Kubernetes.</p>
</div>
<div class="paragraph">
<p>Single-user Che uses RAM in this distribution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Che server pod uses up to 1 GB of RAM. The initial request for RAM is 256 MB. The Che server pod rarely uses more than 800 MB RAM.</p>
</li>
<li>
<p>Workspaces use 2 GB of RAM.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="multi-user-prerequisites">Multi-user prerequisites</h3>
<div class="paragraph">
<p>You must have at least 5 GB of RAM to run multi-user Che. The Keycloak authorization server and PostgreSQL database require the extra RAM. Multi-user Che uses RAM in this distribution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Che server: approximately 750 MB</p>
</li>
<li>
<p>Keycloak: approximately 1 GB</p>
</li>
<li>
<p>PostgreSQL: approximately 515 MB</p>
</li>
<li>
<p>Workspaces: 2 GB of RAM per workspace. The total workspace RAM depends on the size of the workspace runtime(s) and the number of concurrent workspace pods.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="setting-default-workspace-ram-limits">Setting default workspace RAM limits</h3>
<div class="paragraph">
<p>The default workspace RAM limit and the RAM allocation request can be configured by passing the <code>CHE_WORKSPACE_DEFAULT__MEMORY__LIMIT__MB</code> and <code>CHE_WORKSPACE_DEFAULT__MEMORY__REQUEST__MB</code> parameters to a Che deployment.</p>
</div>
<div class="paragraph">
<p>For example, use the following configuration to limit the amount of RAM used by workspaces to 2048 MB and to request the allocation of 1024 MB of RAM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ kubectl set env dc/che CHE_WORKSPACE_DEFAULT__MEMORY__LIMIT__MB=2048 \
                         CHE_WORKSPACE_DEFAULT__MEMORY__REQUEST__MB=1024</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The user can override the default values when creating a workspace.</p>
</li>
<li>
<p>A RAM request greater than the RAM limit is ignored.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requirements-for-resource-allocation-and-quotas">Requirements for resource allocation and quotas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Workspace pods are created in the account of the user who deploys Che.  The user needs enough quota for RAM, CPU, and storage to create the pods.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up-the-project-workspace">Setting up the project workspace</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Workspace objects are created differently depending on the configuration. Eclipse Che currently supports two different configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Single Kubernetes project</p>
</li>
<li>
<p>Multi Kubernetes project</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="setting-up-a-single-openshift-project">Setting up a single Kubernetes project</h3>
<div class="paragraph">
<p>To setup a single Kubernetes project:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define the service account used to create workspace objects with the <code>CHE_OPENSHIFT_SERVICEACCOUNTNAME</code> variable.</p>
</li>
<li>
<p>To ensure this service account is visible to the Che server, put the service and the Che server in the same namespace.</p>
</li>
<li>
<p>Give the service account permissions to create and edit Kubernetes resources.</p>
</li>
<li>
<p>If the developer needs to create an object outside of the service accounts bound namespace, give the service account cluster-admin rights by running this command:</p>
<div class="listingblock">
<div class="content">
<pre>$ kubectl adm policy add-cluster-role-to-user self-provisioner system:serviceaccount:eclipse-che:che</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the command above, <code>eclipse-che</code> is the Che namespace.</p>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-a-multi-openshift-project">Setting up a multi Kubernetes project</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To create workspace objects in different namespaces for each user, set the <code>NULL_CHE_INFRA_OPENSHIFT_PROJECT</code> variable to <code>NULL</code>.</p>
</li>
<li>
<p>To create resources on behalf of the currently logged-in user, use the user’s Kubernetes tokens.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-the-che-server-uses-PVCs-and-PVs-for-storage">How the Che server uses PVCs and PVs for storage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Che server, Keycloak and PostgreSQL pods, and workspace pods use Persistent Volume Claims (PVCs), which are bound to the physical Persistent Volumes (PVs) with <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes">ReadWriteOnce access mode</a>. When the deployment YAML files run, they define the Che PVCs. You can configure <a href="#storage-strategies-for-che-workspaces">workspace PVC</a> access mode and claim size with Che deployment environment variables.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following two conditions prevent the user from running multiple workspaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Che uses the <code>common</code> Persistent Volume Claim (PVC) strategy</p>
</li>
<li>
<p>Persistent volumes (PVs) use <code>ReadWriteOnce</code> (RWO) access mode</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To work around this limitation, use one of the following measures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set <code>ReadWriteMany</code> (RWX) access mode for PVs</p>
</li>
<li>
<p>Use the <code>unique</code> PVC strategy</p>
</li>
<li>
<p>Use the <code>per-workspace</code> strategy</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="storage-requirements-for-che-infrastructure">Storage requirements for Che infrastructure</h3>
<div class="ulist">
<ul>
<li>
<p>Che server: 1 GB to store logs and initial workspace stacks.</p>
</li>
<li>
<p>Keycloak: 2 PVCs, 1 GB each to store logs and Keycloak data.</p>
</li>
<li>
<p>PostgreSQL: 1 GB PVC to store database.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="storage-strategies-for-che-workspaces">Storage strategies for Che workspaces</h3>
<div class="paragraph">
<p>The workspace PVC strategy is configurable:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">strategy</th>
<th class="tableblock halign-left valign-top">details</th>
<th class="tableblock halign-left valign-top">pros</th>
<th class="tableblock halign-left valign-top">cons</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>unique (default)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One PVC per workspace volume or user-defined PVC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage isolation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An undefined number of PVs is required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>common</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One PVC for all workspaces in one Kubernetes Namespace</p>
<p class="tableblock">Sub-paths pre-created</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Easy to manage and control storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workspaces must be in a separate Kubernetes Namespace if PV does not support ReadWriteMany (RWX) access mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>per-workspace</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One PVC for one workspace</p>
<p class="tableblock">Sub-paths pre-created</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Easy to manage and control storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workspace containers must all be in one pod if PV does not support ReadWriteMany (RWX) access mode</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="unique-pvc-strategy">Unique PVC strategy</h3>
<div class="sect3">
<h4 id="how-the-unique-pvc-strategy-works">How the unique PVC strategy works</h4>
<div class="paragraph">
<p>Every Che Volume of workspace gets its own PVC, which means workspace PVCs are created when a workspace starts for the first time. Workspace PVCs are deleted when a corresponding workspace is deleted.</p>
</div>
<div class="paragraph">
<p>User-defined PVCs are created with few modifications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>they are provisioned with genarated names to garantee that it is not conflicting with other PVCs in namespace;</p>
</li>
<li>
<p>subpaths of mount volumes that reference user-defined PVCs are prefixed with <code>{workspace id}/{PVC name}</code>.
It is done to have the same data structure on PV on different PVC strategies;</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="enabling-a-unique-strategy">Enabling a unique strategy</h4>
<div class="paragraph">
<p>If you have already deployed Che with another strategy, set the <code>CHE_INFRA_KUBERNETES_PVC_STRATEGY</code> variable to <code>unique</code> in <code>dc/che</code>.
Note that existing workspaces data won&#8217;t be migrated and they will use new unique PVC per Che Volume without cleaning up existing PVCs.</p>
</div>
<div class="paragraph">
<p>If applying the <code>che-server-template.yaml</code> configuration, pass <code>-p CHE_INFRA_KUBERNETES_PVC_STRATEGY=unique</code> to the <code>kubectl new-app</code> command.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common-pvc-strategy">Common PVC Strategy</h3>
<div class="sect3">
<h4 id="how-the-common-pvc-strategy-works">How the common PVC strategy works</h4>
<div class="paragraph">
<p>All workspaces (within one Kubernetes Namespace) use the same PVC to store data declared in their volumes (projects and workspace logs by default and whatever additional <a href="volumes.html">volumes</a> that a user can define.)</p>
</div>
<div class="paragraph">
<p>User-defined PVCs are ignored and volumes that reference PVCs are replaced with volume that references common PVC.
The corresponding containers volume mounts are relinked to common volume and subpaths are prefixed with <code>'{workspaceId}/{originalPVCName}'</code>.</p>
</div>
<div class="paragraph">
<p>User-defined PVC name is used as Che Volume name. It means that if Machine is configured to use Che Volume with the same name as user-defined
PVC has then they will use the same shared folder in common PVC.</p>
</div>
<div class="paragraph">
<p>A PV that is bound to PVC <code>che-claim-workspace</code> will have the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>pv0001
  workspaceid1
  workspaceid2
  workspaceidn
    che-logs projects &lt;volume1&gt; &lt;volume2&gt; &lt;User-defined PVC name 1 | volume 3&gt; ...</pre>
</div>
</div>
<div class="paragraph">
<p>Volumes can be anything that a user defines as volumes for workspace machines.  The volume name is equal to the directory name in <code>${PV}/${ws-id}</code>.</p>
</div>
<div class="paragraph">
<p>When a workspace is deleted, a corresponding subdirectory (<code>${ws-id}</code>) is deleted in the PV directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="enabling-the-common-strategy">Enabling the common strategy</h4>
<div class="paragraph">
<p>If you have already deployed Che with another strategy, set the <code>CHE_INFRA_KUBERNETES_PVC_STRATEGY</code> variable to <code>common</code> in <code>dc/che</code>.
Note that existing workspaces data won&#8217;t be migrated and they will use common PVC without cleaning up existing PVCs.</p>
</div>
<div class="paragraph">
<p>If applying the <code>che-server-template.yaml</code> configuration, pass <code>-p CHE_INFRA_KUBERNETES_PVC_STRATEGY=common</code> to the <code>kubectl new-app</code> command.</p>
</div>
</div>
<div class="sect3">
<h4 id="restrictions-on-using-common-pvc-strategy">Restrictions on using the common PVC strategy</h4>
<div class="paragraph">
<p>When the <code>common</code> strategy is used and a workspace PVC access mode is ReadWriteOnce (RWO), only one Kubernetes node can simultaneously use the PVC.  If there are several nodes, you can use the <code>common</code> strategy, but the workspace PVC access mode is ReadWriteMany (RWM). Multiple nodes can use this PVC simultaneously.</p>
</div>
<div class="paragraph">
<p>To change the access mode for workspace PVCs, pass the <code>CHE_INFRA_KUBERNETES_PVC_ACCESS_MODE=ReadWriteMany</code> environment variable to Che deployment either when initially deploying Che or through the Che deployment update.</p>
</div>
<div class="paragraph">
<p>Another restriction is that only pods in the same namespace can use the same PVC.  The <code>CHE_INFRA_KUBERNETES_PROJECT</code> environment variable should not be empty.  It should be either the Che server namespace where objects can be created with the Che service account (SA) or a dedicated namespace where a token or a user name and password need to be used.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="per-workspace-pvc-strategy">Per workspace PVC strategy</h3>
<div class="sect3">
<h4 id="how-the-per-workspace-pvc-strategy-works">How the per-workspace PVC strategy works</h4>
<div class="paragraph">
<p>The <code>per-workspace</code> strategy works similarly to the <code>common</code> PVC strategy. The only difference is that all workspace volumes (but not all workspaces) use the same PVC to store data (projects and workspace logs by default and any additional <a href="volumes.html">volumes</a> that a user can define).</p>
</div>
</div>
<div class="sect3">
<h4 id="enabling-a-per-workspace-strategy">Enabling a per-workspace strategy</h4>
<div class="paragraph">
<p>If you have already deployed Che with another strategy, set the <code>CHE_INFRA_KUBERNETES_PVC_STRATEGY</code> variable to <code>per-workspace</code> in <code>dc/che</code>.
Note that existing workspaces data won&#8217;t be migrated and they will use common PVC per workspace without cleaning up existing PVCs.</p>
</div>
<div class="paragraph">
<p>If applying the <code>che-server-template.yaml</code> configuration, pass <code>-p CHE_INFRA_KUBERNETES_PVC_STRATEGY=per-workspace</code> to the <code>kubectl new-app</code> command.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="updating-your-che-deployment">Updating your Che deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To update a Che deployment:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Change the image tag:</p>
<div class="paragraph">
<p>You can change the image tag in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On the command line, edit the image tag by running:</p>
<div class="listingblock">
<div class="content">
<pre>$ kubectl edit dc/che</pre>
</div>
</div>
</li>
<li>
<p>In the Kubernetes web console, edit the <code>image:tag</code> line in the YAML file in <strong>Deployments</strong></p>
</li>
<li>
<p>Using the Docker service:</p>
<div class="listingblock">
<div class="content">
<pre>$ kubectl set image dc/che che=eclipse/che-server:${VERSION} --source=docker</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Update Keycloak and PostgreSQL deployments (optional):</p>
<div class="ulist">
<ul>
<li>
<p>Run the <code>eclipse/che-keycloak</code> command.</p>
</li>
<li>
<p>Run the <code>eclipse/che-postgres</code> command.</p>
<div class="paragraph">
<p>You can get the list of available versions at <a href="https://github.com/eclipse/che/tags">Che GitHub page</a>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Change the pull policy (optional):</p>
<div class="paragraph">
<p>To change the pull policy, do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add  <code>--set cheImagePullPolicy=IfNotPresent</code> to the <a href="openshift-multi-user.html">Che deployment</a>.</p>
</li>
<li>
<p>Manually edit <code>dc/che</code> after deployment.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The default pull policy is <code>Always</code>. The default tag is <code>nightly</code>. This tag sets the image pull policy to <code>Always</code> and triggers a new deployment with a newer image, if available.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scalability">Scalability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run more workspaces, <a href="https://kubernetes.io/docs/concepts/architecture/nodes/#management">add more nodes to your Kubernetes cluster</a>.  An error message is returned when the system is out of resources.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gdpr">GDPR</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To delete data or request the administrator to delete data, run this command with the user or administrator token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X DELETE http://che-server/api/user/{id}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="debug-mode">Debug mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run Che Server in debug mode, set the following environment variable in the Che deployment to <code>true</code> (default is <code>false</code>):</p>
</div>
<div class="paragraph">
<p><code>CHE_DEBUG_SERVER=true</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kubernetes-or-openshift-admin-guide-private-docker-registries">Private Docker registries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See <a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/">Kubernetes documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="che-server-logs">Che server logs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Logs are persisted in a PV .The PVC <code>che-data-volume</code> is <a href="https://github.com/eclipse/che/blob/master/deploy/kubernetes/helm/che/templates/deployment.yaml#L57">created</a> and bound to a PV after Che deploys to Kubernetes.</p>
</div>
<div class="paragraph">
<p>To retrieve logs, do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the <code>kubectl get log dc/che</code> command.</p>
</li>
<li>
<p>Run the <code>kubectl describe pvc che-data-claim</code> command to find the PV. Next, run the <code>kubectl describe pv $pvName</code> command with the PV to get a local path with the logs directory. Be careful with permissions for that directory, since once changed, Che server will not be able to write to a file.</p>
</li>
<li>
<p>In the Kubernetes web console, select <strong>Pods &gt; che-pod &gt; Logs</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible to configure Che master not to store logs, but produce JSON encoded logs to output instead. It may be used to collect logs by systems such as Logstash. To configure JSON logging instead of plain text environment variable <code>CHE_LOGS_APPENDERS_IMPL</code> should have value <code>json</code>. See more at <a href="logging.html">logging docs</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="workspace-logs">Workspace logs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Workspace logs are stored in an PV bound to <code>che-claim-workspace</code> PVC. Workspace logs include logs from workspace agent, <a href="what-are-workspaces.html#bootstrapper">bootstrapper</a> and other agents if applicable.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="che-master-states">Che master states</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Che master has three possible states:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>RUNNING</code></p>
</li>
<li>
<p><code>PREPARING_TO_SHUTDOWN</code></p>
</li>
<li>
<p><code>READY_TO_SHUTDOWN</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>PREPARING_TO_SHUTDOWN</code> state means that no new workspace startups are allowed. This situation can cause two different results:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If your infrastructure does not support workspace recovery, all running workspaces are forcibly stopped.</p>
</li>
<li>
<p>If your infrastructure does support workspace recovery, any workspaces that are currently starting or stopping is allowed to finish that process. Running workspaces do not stop.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For those that did not stop, automatic fallback to the shutdown with full workspaces stopping will be performed.</p>
</div>
<div class="paragraph">
<p>If you want a full shutdown with workspaces stopped, you can request this by using the <code>shutdown=true</code> parameter. When preparation process is finished, the <code>READY_TO_SHUTDOWN</code> state is set which allows to stop current Che master instance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kubernetes-or-openshift-admin-guide-che-workspace-termination-grace-period">Che workspace termination grace period</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default grace termination period of Kubernetes workspace pods is <code>0</code>.  This setting terminates pods almost instantly and significantly decreases the time required for stopping a workspace.</p>
</div>
<div class="paragraph">
<p>To increase the grace termination period, use the following environment variable: <code>CHE_INFRA_KUBERNETES_POD_TERMINATION__GRACE__PERIOD__SEC</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the <code>terminationGracePeriodSeconds</code> variable is explicitly set in the Kubernetes recipe, the <code>CHE_INFRA_KUBERNETES_POD_TERMINATION__GRACE__PERIOD__SEC</code> environment variable does not override the recipe.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kubernetes-or-openshift-admin-guide-che-workspace-stop-on-pods-removing">Auto-stopping a workspace when its pods are removed</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Che Server includes a job that automatically stops workspace runtimes if their pods have been terminated. Pods are terminated when, for example, users remove them from the Kubernetes console, administrators terminate them to prevent misuse, or an infrastructure node crashes.</p>
</div>
<div class="paragraph">
<p>The job is disabled by default to avoid problems in configurations where Che Server cannot interact with the Kubernetes API without user intervention.</p>
</div>
<div class="paragraph">
<p>The job cannot function with the following Che Server configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Che Server communicates with the Kubernetes API using a token from the OAuth provider.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The job can function with the following Che Server configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Workspaces objects are created in the same namespace where Che Server is located.</p>
</li>
<li>
<p>The <strong>cluster-admin</strong> service account token is mounted to the Che Server pod.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To enable the job, set the <code>CHE_INFRA_KUBERNETES_RUNTIMES__CONSISTENCY__CHECK__PERIOD__MIN</code> environment variable to contain a value greater than <code>0</code>. The value is the time period in minutes between checks for runtimes without pods.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="updating-che-without-stopping-active-workspaces">Updating Che without stopping active workspaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The differences between a Recreate update and a Rolling update:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Recreate update</th>
<th class="tableblock halign-left valign-top">Rolling update</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Che downtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No Che downtime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New deployment starts in parallel and traffic is hot-switched</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="performing-a-recreate-update">Performing a recreate update</h3>
<div class="paragraph">
<p>To perform a recreate update:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that the new master version is fully API compatible with the old workspace agent version.</p>
</li>
<li>
<p>Set the deployment update strategy to Recreate</p>
</li>
<li>
<p>Make POST request to the <code>/api/system/stop</code> api to start WS master suspend. This means that all new attempts to start workspaces will be refused, and all current starts and stops will be finished. Note that this method requires system admin credentials.</p>
</li>
<li>
<p>Make periodical <code>GET</code> requests to the <code>/api/system/state</code> API, until it returns the <code>READY_TO_SHUTDOWN</code> state. Also, you can check for "System is ready to shutdown" in the server logs.</p>
</li>
<li>
<p>Perform new deploy.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="performing-a-rolling-update">Performing a rolling update</h3>
<div class="paragraph">
<p>To perform a rolling update:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that the new master is fully API compatible with the old ws agent versions, as well as database compatibility.  It is impossible to use database migrations on this update mode.</p>
</li>
<li>
<p>Set the deployment update strategy set to Rolling.</p>
</li>
<li>
<p>Ensure <code>terminationGracePeriodSeconds</code> deployment parameter has enough value (see details below).</p>
</li>
<li>
<p>Press <strong>Deploy</strong> button or execute <code>kubectl rollout latest che</code> from cli client.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="known-issues">Known issues</h4>
<div class="ulist">
<ul>
<li>
<p>Workspaces may fallback to the stopped state when they are started five to thirty seconds before the network traffic are switched to the new pod. This happens when the bootstrappers use the Che server route URL for notifying the Che Server that bootstrapping is done. Since traffic is already switched to the new Che server, the old Che server cannot get the bootstrapper&#8217;s report and fails to start after the waiting timeout is reached. If the old Che server is killed before this timeout, the workspaces can be stuck in the <code>STARTING</code> state. The <code>terminationGracePeriodSeconds</code> parameter must define enough time to cover the workspace start timeout, which is eight minutes plus some additional time. Typically, setting <code>terminationGracePeriodSeconds</code> to 540 sec is enough to cover all timeouts.</p>
</li>
<li>
<p>Users may experience problems with websocket reconnections or missed events published by WebSocket connection when a workspace is <code>STARTED</code> but dashboard displays that it is <code>STARTING</code>. In this case, you need to reload the page to restore connections and the actual workspace states.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="update-with-db-migrations-or-api-incompatibility">Updating with database migrations or API incompatibility</h3>
<div class="paragraph">
<p>If new version of Che server contains some DB migrations, but there is still API compatibility between old and new version, recreate update type may be used, without stopping running workspaces.</p>
</div>
<div class="paragraph">
<p>API incompatible versions should be updated with full workspaces stop. It means that <code>/api/system/stop?shutdown=true</code> must be called prior to update.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deleting-deployments">Deleting deployments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The fastest way to completely delete Che and its infrastructure components is to delete the project and namespace.</p>
</div>
<div class="paragraph">
<p>To delete Che and components:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ kubectl delete namespace che</pre>
</div>
</div>
<div class="paragraph">
<p>You can use selectors to delete particular deployments and associated objects.</p>
</div>
<div class="paragraph">
<p>To remove all Che server related objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ kubectl delete all -l=app=che</pre>
</div>
</div>
<div class="paragraph">
<p>To remove all Keycloak related objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ kubectl delete all -l=app=keycloak</pre>
</div>
</div>
<div class="paragraph">
<p>To remove all PostgreSQL-related objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ kubectl delete all -l=app=postgres</pre>
</div>
</div>
<div class="paragraph">
<p>PVCs, service accounts and role bindings should be deleted separately because <code>kubectl delete all</code> does not delete them.</p>
</div>
<div class="paragraph">
<p>To delete Che server PVC, ServiceAccount and RoleBinding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ kubectl delete sa -l=app=che
$ kubectl delete rolebinding -l=app=che</pre>
</div>
</div>
<div class="paragraph">
<p>To delete Keycloak and PostgreSQL PVCs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ kubectl delete pvc -l=app=keycloak
$ kubectl delete pvc -l=app=postgres</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitoring-che-master-server">Monitoring Che Master Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Master server emits metrics in Prometheus format by default on port <code>8087</code> of the Che server host
(this can be customized by the <code>che.metrics.port</code>
<a href="properties.html#properties-and-environment-variables">configuration property</a>).</p>
</div>
<div class="paragraph">
<p>You can configure your own Prometheus deployment to scrape the metrics (as per convention, the
metrics are published on the <code>&lt;CHE_HOST&gt;:8087/metrics</code> endpoint).</p>
</div>
<div class="paragraph">
<p>The Che&#8217;s Helm chart can optionally install Prometheus and Grafana servers preconfigured to collect
the metrics of the Che server. When you set the <code>global.metricsEnabled</code> value to <code>true</code> when
installing Che&#8217;s Helm chart, Prometheus and Grafana servers are automatically deployed.
The servers are accessible on <code>prometheus-&lt;CHE_NAMESPACE&gt;.domain</code> or <code>grafana-&lt;CHE_NAMESPACE&gt;.domain</code>
domains respectively. The Grafana server is preconfigured with a sample dashboard showing the memory
usage of the Che server. You can log in to the Grafana server using the predefined username <code>admin</code>
with the default password <code>admin</code>.</p>
</div>
</div>
</div>

    <div class="tags">
        
        <b>Tags: </b>
        
        
        
        <a href="tag_installation.html" class="btn btn-default navbar-btn cursorNorm" role="button">installation</a>
        
        
        
        <a href="tag_kubernetes.html" class="btn btn-default navbar-btn cursorNorm" role="button">kubernetes</a>
        
        
        
    </div>

<!-- 
 -->

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
                    Eclipse Che - Documentation <br/>
                    Site last generated: Nov 29, 2019 <br/>
                    <hr>
                    <a href="http://www.eclipse.org" target="_blank">Eclipse Foundation</a><br/>
                    <a href="http://www.eclipse.org/legal/privacy.php" target="_blank">Privacy Policy</a><br/>
                    <a href="http://www.eclipse.org/legal/termsofuse.php" target="_blank">Terms of Use</a><br/>
                    <a href="https://www.eclipse.org/legal/epl-2.0/" target="_blank">Eclipse Public License</a><br/>
                    <a href="http://www.eclipse.org/legal" target="_blank">Legal Resources</a><br/>
                </div>
            </div>
</footer>




    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
