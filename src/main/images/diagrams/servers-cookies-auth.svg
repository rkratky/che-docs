<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="639px" preserveAspectRatio="none" style="width:759px;height:639px;" version="1.1" viewBox="0 0 759 639" width="759px" zoomAndPan="magnify"><defs><filter height="300%" id="f1c4x7s4ftb4gt" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#D3D3D3" height="617.8203" style="stroke: #A80036; stroke-width: 1.0;" width="361" x="387.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="517" y="16.0669">Secure Server</text><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="301.5" y="205.0938"/><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="301.5" y="263.3594"/><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="301.5" y="321.625"/><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="86.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="443.5" y="89.5625"/><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="443.5" y="379.8906"/><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="129.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="443.5" y="480.2891"/><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="688.5" y="551.5547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="65" x2="65" y1="58.4297" y2="627.8203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="306.5" x2="306.5" y1="58.4297" y2="627.8203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="448.5" x2="448.5" y1="58.4297" y2="627.8203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="693.5" x2="693.5" y1="58.4297" y2="627.8203"/><rect fill="#FEFECE" filter="url(#f1c4x7s4ftb4gt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="28" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="35" y="43.1279">Browser</text><rect fill="#FEFECE" filter="url(#f1c4x7s4ftb4gt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="261.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="268.5" y="43.1279">CheServer</text><rect fill="#FEFECE" filter="url(#f1c4x7s4ftb4gt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="411.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="418.5" y="43.1279">JwtProxy</text><rect fill="#FEFECE" filter="url(#f1c4x7s4ftb4gt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="662.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="669.5" y="43.1279">Server</text><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="301.5" y="205.0938"/><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="301.5" y="263.3594"/><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="301.5" y="321.625"/><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="86.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="443.5" y="89.5625"/><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="443.5" y="379.8906"/><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="129.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="443.5" y="480.2891"/><rect fill="#FFFFFF" filter="url(#f1c4x7s4ftb4gt)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="688.5" y="551.5547"/><polygon fill="#A80036" points="431.5,85.5625,441.5,89.5625,431.5,93.5625,435.5,89.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="65.5" x2="437.5" y1="89.5625" y2="89.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="72.5" y="84.4966">Call without token</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="453.5" x2="495.5" y1="118.6953" y2="118.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="495.5" x2="495.5" y1="118.6953" y2="131.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="454.5" x2="495.5" y1="131.6953" y2="131.6953"/><polygon fill="#A80036" points="464.5,127.6953,454.5,131.6953,464.5,135.6953,460.5,131.6953" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="460.5" y="113.6294">Check that token is absent</text><polygon fill="#A80036" points="76.5,171.9609,66.5,175.9609,76.5,179.9609,72.5,175.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70.5" x2="447.5" y1="175.9609" y2="175.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="82.5" y="155.7622">Redirect to the special</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="82.5" y="170.895">page `loader.html` on Che Server</text><polygon fill="#A80036" points="289.5,201.0938,299.5,205.0938,289.5,209.0938,293.5,205.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="65.5" x2="295.5" y1="205.0938" y2="205.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="72.5" y="200.0278">Load `loader.html`</text><polygon fill="#A80036" points="76.5,230.2266,66.5,234.2266,76.5,238.2266,72.5,234.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70.5" x2="305.5" y1="234.2266" y2="234.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="82.5" y="229.1606">Return `loader.html` page</text><polygon fill="#A80036" points="289.5,259.3594,299.5,263.3594,289.5,267.3594,293.5,263.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="65.5" x2="295.5" y1="263.3594" y2="263.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="72.5" y="258.2935">Authenticate</text><polygon fill="#A80036" points="76.5,288.4922,66.5,292.4922,76.5,296.4922,72.5,292.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70.5" x2="305.5" y1="292.4922" y2="292.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="82.5" y="287.4263">Send a Che Server token</text><polygon fill="#A80036" points="289.5,317.625,299.5,321.625,289.5,325.625,293.5,321.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="65.5" x2="295.5" y1="321.625" y2="321.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="72.5" y="316.5591">Fetch a machine token</text><polygon fill="#A80036" points="76.5,346.7578,66.5,350.7578,76.5,354.7578,72.5,350.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70.5" x2="305.5" y1="350.7578" y2="350.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="82.5" y="345.6919">Send the machine token</text><polygon fill="#A80036" points="431.5,375.8906,441.5,379.8906,431.5,383.8906,435.5,379.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="65.5" x2="437.5" y1="379.8906" y2="379.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="72.5" y="374.8247">Store token in cookies</text><polygon fill="#A80036" points="76.5,405.0234,66.5,409.0234,76.5,413.0234,72.5,409.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70.5" x2="447.5" y1="409.0234" y2="409.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="82.5" y="403.9575">Send response header for setting http-only cookie</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="65.5" x2="107.5" y1="438.1563" y2="438.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="107.5" x2="107.5" y1="438.1563" y2="451.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="66.5" x2="107.5" y1="451.1563" y2="451.1563"/><polygon fill="#A80036" points="76.5,447.1563,66.5,451.1563,76.5,455.1563,72.5,451.1563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="72.5" y="433.0903">Redirect to originally requested URL</text><polygon fill="#A80036" points="431.5,476.2891,441.5,480.2891,431.5,484.2891,435.5,480.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="65.5" x2="437.5" y1="480.2891" y2="480.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="72.5" y="475.2231">Call with token in cookies</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="453.5" x2="495.5" y1="509.4219" y2="509.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="495.5" x2="495.5" y1="509.4219" y2="522.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="454.5" x2="495.5" y1="522.4219" y2="522.4219"/><polygon fill="#A80036" points="464.5,518.4219,454.5,522.4219,464.5,526.4219,460.5,522.4219" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="460.5" y="504.356">Check that a valid token is present</text><polygon fill="#A80036" points="676.5,547.5547,686.5,551.5547,676.5,555.5547,680.5,551.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="453.5" x2="682.5" y1="551.5547" y2="551.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="460.5" y="546.4888">Call</text><polygon fill="#A80036" points="464.5,576.6875,454.5,580.6875,464.5,584.6875,460.5,580.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="458.5" x2="692.5" y1="580.6875" y2="580.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="470.5" y="575.6216">Respond</text><polygon fill="#A80036" points="76.5,605.8203,66.5,609.8203,76.5,613.8203,72.5,609.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70.5" x2="447.5" y1="609.8203" y2="609.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="82.5" y="604.7544">Respond</text><!--
Source code of diagram in plantuml format:
@startuml
hide footbox
skinparam ParticipantPadding 20
skinparam BoxPadding 10

participant Browser
participant JwtProxy
participant Server
participant CheServer

box "Secure Server" #LightGray
      participant JwtProxy
      participant Server
end box

Browser -> JwtProxy: Call without token
activate JwtProxy
JwtProxy -> JwtProxy: Check that token is absent

Browser <- JwtProxy: Redirect to the special \npage `loader.html` on Che Server
deactivate JwtProxy

Browser -> CheServer: Load `loader.html`
activate CheServer
Browser <- CheServer: Return `loader.html` page
deactivate CheServer

Browser -> CheServer: Authenticate
activate CheServer
Browser <- CheServer: Send a Che Server token
deactivate CheServer

Browser -> CheServer: Fetch a machine token
activate CheServer
Browser <- CheServer: Send the machine token
deactivate CheServer

Browser -> JwtProxy: Store token in cookies
activate JwtProxy
Browser <- JwtProxy: Send response header for setting http-only cookie
deactivate JwtProxy

Browser -> Browser: Redirect to originally requested URL

Browser -> JwtProxy: Call with token in cookies
activate JwtProxy

JwtProxy -> JwtProxy: Check that a valid token is present

JwtProxy -> Server: Call
activate Server

JwtProxy <- Server: Respond
deactivate Server

Browser <- JwtProxy: Respond
deactivate JwtProxy

@enduml
--></g></svg>
